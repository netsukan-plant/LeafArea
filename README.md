# LeafArea
スキャンした植物の葉面積を算出するためのプログラムです．
グレースケール変換及び，HSV解析による一定の範囲の色ピクセルを抜き出し，
別途計算した2cm正方形のピクセル数と照らし合わせることで面積算出を行います．

HSVについてわからない人はネットで調べてね^ ^
-------

# はじめに
本プログラムは，Pythonを主に使用します．Pythonがインストールされていない人は，他サイトを参考にしてPythonのインストールを行なってください．
なお，パイソンファイルの実行はPython3の場合(2024年時点での最新はPython3系)は
```bash
python3 main.py
```
のようにコマンドを実行することで行います．

-------
# ファイル構成
## プログラムファイル
- `main.py` : メインプログラム．これを実行することで葉面積を計算できます．
- `proofreading.py` : 面積補正を行うためのプログラム．メインプログラムを実行すると派生して実行されるので，直接実行する必要はありません．
- `setting.py` : 葉面積算出のためのプログラム．閾値を調整したいとき以外は実行の必要はありません．

## csvファイル
- `thresholds.csv` : 葉面積算出の閾値を設定しておくためのcsvファイル．settign.pyを実行してしまうと変更されるので要注意．研究で同じ閾値を利用したい場合は，念のためローカルにバックアップファイルをコピーして用意しておく，もしくは値を記録しておくことを勧めます．

## 画像ファイル
- `reference_square.jpg` : 面積校正用の画像ファイル．2cm×2cmの四角を同じ倍率でスキャンして読み込ませる．変更したい場合は同じファイル名で置き換える．
- `sample.jpg` : setting.pyを実行した時に利用する，サンプル画像．変更したい場合は同じファイル名で置き換える．

## フォルダ
- `images` : 解析対象となる画像を格納するフォルダ．ファイル名はなんでも良いが，画像形式は「jpeg」「jpg」「png」のみ．
- `results` : 結果を出力するファイル．ない場合は自動生成されるので問題なし．この中に，実行時間がフォルダ名になっている画像が生成される．

## システムフォルダ
- .gitignore : gitに共有しないファイルを指定するためのファイル．変な画像をLEAFARE内に入れたい場合はここに指定すれば良いが，基本的には触る必要はない．
- その他 : おそらくプログラムの実行過程で生成されるファイル．多分消してもまた自動で作られるが，特に消す必要性もないので基本的には触らない．

-------

# プログラムの実行方法

## `main.py`プログラムの実行手順について．

1. **入力データの準備**
    ### 入力画像
    - imagesの中に画像を全て格納する．ない場合は，作成する．ファイル名はなんでも良いが，名前順に実行されるのでわかりやすい番号などを進める．
    - 対応拡張子はpng,jpeg,
    ### 面積補正画像
    - `reference.jpg`として，ディレクトリ直下に保存しておく．
    - 葉っぱをスキャンしたものと同じスキャナ，解像度で，真っ黒の厳密に1片が2cmの正方形をスキャンした画像を読み込ませる．
    - 別のファイル形式（pngなど）を用いたい場合は，`main.py`内のパスを変更する．
    ### 閾値
    - `thresholds.csv`に保存しておく．設定方法は，`setting.py`の使用方法を参照のこと．

2. **プログラムの実行方法**
    - ターミナルまたはコマンドプロンプトを開き、`main.py`が存在するディレクトリに移動する。
    - 以下のコマンドを実行してプログラムを開始する:
        ```bash
        python3 main.py
        ```
        または```bash
        python main.py
        ```
        または```bash
        py main.py
        ```
    - 無事に実行されている場合は，モード選択がターミナルに表示されるので，ノイズの除去処理を行うかどうかの選択をキーボードで行なう．
    - 処理が完了した画像のファイル名がターミナルに出力されていく．失敗する場合は，python実行方法について文献をあたってください．

3. **出力ファイル**
    - プログラムの実行後、`results`内に実行時間のファイル名として保存される．


## `setting.py`プログラムの実行手順について．

1. **はじめに**
    - 実行前に，前回の閾値が保存の必要がないかを確認する．プログラムを実行して少しでも変更を行うと，閾値が変更されてしまう．

2. **プログラムの実行**
    - ターミナルまたはコマンドプロンプトを開き、`setting.py`が存在するディレクトリに移動する。
    - 以下のコマンドを実行してプログラムを開始する:
        ```bash
        python3 setting.py
        ```
    - 無事に実行されている場合は，閾値設定用の画面が表示される．少し重い可能性があるので，数分ならば時間がかかってもめげずに待つ．

3. **閾値の変更**
    - スライドバーを動かし，適切な閾値に設定する．少し重いので反応が遅いことがあるが，怒らない．
    - グレースケール処理の閾値を変更したい場合は，一番上のバーを変更する．
    - HSV解析の上限，下限を変更したい場合はそれ以外を変更する．
    - これに決めた！と思ったらキーボードの`s`ボタンを押す．この時，特に画面上では何もおこならないが変更は保存されている．
    - 成功した場合ターミナルには，"Thresholds saved to {file_path}"と表示されている．
 
4. **プログラムの終了**
    - プログラムを終了したい場合は，キーボードの`q`ボタンを押す．
    - 画面が閉じて，終了する．
    - 全然終了しない場合は，ターミナルに戻って`control+C`で強制終了しても良い．